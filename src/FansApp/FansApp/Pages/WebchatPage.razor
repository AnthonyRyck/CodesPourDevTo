@page "/webchat"

@inject IWebChatViewModel ViewModel

<h3>Webchat</h3>

<div>
	<div>
		<h5>Code Webchat "incorporé"</h5>
		<div>Passe par le "BoT Service Azure" pour accéder aux Questions/Réponses.</div>
	</div>

	<div>
		@*Mettre le iFrame*@
		<iframe src='https://webchat.botframework.com/embed/***ID-BOT***?s=***THE-BIG-KEY*****'
			style='min-width: 400px; width: 100%; max-height: 500px;' />
	</div>
</div>

<hr />

<div>
	<h4>Appel sur le service QnA Maker</h4>

	<div class="row">
		<div class="col-6">
			<div>
				<div>
					@*Afficher le bot maison*@
					@foreach (var message in ViewModel.TousLesMessages)
					{
						<div class="@ViewModel.GetClass(message.IsQuestion)"
							 align="@ViewModel.GetAlign(message.IsQuestion)">
							
							@message.TexteMessage.Replace("\"", string.Empty)
						</div>
					}
				</div>

				<div>
					<input @bind-value="ViewModel.Question"
								@onkeydown="@Enter"
								type="text" />
				</div>
			</div>
		</div>

		<div class="col-6">
			@*Afficher le code json*@
			<pre>
				<code>
					@*Mettre le JSON*@
					@ViewModel.LastMessageJson
				</code>
			</pre>
		</div>
	</div>
</div>


@code {

	public async void Enter(KeyboardEventArgs e)
	{
		if (e.Code == "Enter" || e.Code == "NumpadEnter")
		{
			await ViewModel.PoserLaQuestion(ViewModel.Question);

			StateHasChanged();
		}
	}


	public string plouf { get; set; }
}
